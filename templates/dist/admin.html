<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Administration</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="page-admin">

    <div class="admin-container">
        <div class="navigation-admin">
            <a href="{{ url_for('index') }}" class="btn-retour">‚Üê Retour √† l'accueil</a>
            {% if session.get('is_admin') %}
                <span>Connect√© : {{ session.username }} | 
                    <a href="{{ url_for('logout') }}">D√©connexion</a>
                </span>
            {% else %}
                <a href="{{ url_for('login') }}">Connexion administrateur</a>
            {% endif %}
        </div>

        <h1>üìÅ Interface d'administration</h1>
        <p>G√©rez ici vos cat√©gories et vos documents de la base.</p>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert-message">
                    {% for msg in messages %}
                        <p>{{ msg }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <hr>

        <h2>üìÇ Cat√©gories & Documents</h2>
        {% for cat in categories %}
            <div class="bloc-categorie">
                <h3>{{ cat.nom }}</h3>

                {% if cat.documents %}
                    <ul class="liste-docs">
                        {% for doc in cat.documents %}
                            <li>
                                üìÑ <strong>{{ doc.titre }}</strong>
                                <a href="{{ url_for('uploaded_file', filename=doc.fichier_nom) }}" target="_blank">[Voir]</a>
                                <form method="POST" action="{{ url_for('delete_document', id=doc.id) }}" class="inline-form" onsubmit="return confirm('Supprimer ce document ?')">
                                    <button type="submit" class="btn-supprimer">Supprimer</button>
                                </form>
                                <a href="{{ url_for('edit_document', id=doc.id) }}" class="btn-modifier">Modifier</a>

                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="texte-vide">Aucun document dans cette cat√©gorie.</p>
                {% endif %}
                <form method="POST" action="{{ url_for('edit_category', id=cat.id) }}">
                    <input type="text" name="nom" value="{{ cat.nom }}" required>
                    <button type="submit">Modifier</button>
                </form>
                <form method="POST" action="{{ url_for('delete_category', id=cat.id) }}" onsubmit="return confirm('Supprimer cette cat√©gorie et tous ses documents ?')">
                    <button type="submit" class="btn-supprimer-cat">üóëÔ∏è Supprimer la cat√©gorie</button>
                </form>
            </div>
        {% else %}
            <p class="texte-vide">Aucune cat√©gorie d√©finie.</p>
        {% endfor %}

        <hr>

        <h2>‚ûï Ajouter une cat√©gorie</h2>
        <form method="POST" action="{{ url_for('add_category') }}" class="form-admin">
            <input type="text" name="nom" placeholder="Nom de la cat√©gorie" required>
            <button type="submit">Ajouter</button>
        </form>


        <h2>üì§ Ajouter un document</h2>
        <p>Formats accept√©s : PDF, DOC, DOCX</p>
        <form method="POST" action="{{ url_for('add_document') }}" enctype="multipart/form-data" class="form-admin">
            <input type="text" name="titre" placeholder="Titre du document" ><br>
            <select name="categorie_id" required>
                {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.nom }}</option>
                {% endfor %}
            </select><br>
            <input type="file" name="files[]" accept=".pdf,.doc,.docx" multiple required><br>
            <button type="submit">Ajouter</button>
        </form>
        <hr>


        <form method="POST" action="{{ url_for('reset_db') }}" onsubmit="return confirm('‚ö†Ô∏è Cette action va supprimer toutes les donn√©es !')">
            <button type="submit" class="btn-reset">üîÑ R√©initialiser la base de donn√©es</button>
        </form>
    </div>

</body>
</html>
